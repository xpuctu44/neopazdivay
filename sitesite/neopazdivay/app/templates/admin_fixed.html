<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title or "–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å" }}</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .nav {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      .nav a {
        padding: 10px 15px;
        background: #007bff;
        color: white;
        text-decoration: none;
        border-radius: 4px;
      }
      .nav a:hover {
        background: #0056b3;
      }
      .nav a.active {
        background: #28a745;
      }
      .back-link {
        display: inline-block;
        margin-bottom: 20px;
        color: #007bff;
        text-decoration: none;
      }
      .back-link:hover {
        text-decoration: underline;
      }
      .form-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        font-size: 1em;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        margin-right: 10px;
        margin-bottom: 10px;
      }
      .btn-primary {
        background: #007bff;
        color: white;
      }
      .btn-primary:hover {
        background: #0056b3;
      }
      .btn-success {
        background: #28a745;
        color: white;
      }
      .btn-success:hover {
        background: #218838;
      }
      .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      .table th, .table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      .table th {
        background: #f8f9fa;
        font-weight: bold;
      }
      .table tr:hover {
        background: #f5f5f5;
      }
      .alert {
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 4px;
      }
      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .alert-danger {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <a href="/dashboard" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ dashboard</a>
      
      <h1>‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
      
      <div class="nav">
        <a href="/admin">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/admin/employees">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a>
        <a href="/admin/planning" class="active">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
        <a href="/admin/schedule">–ì—Ä–∞—Ñ–∏–∫</a>
        <a href="/admin/reports">–û—Ç—á–µ—Ç—ã</a>
        <a href="/admin/stores">–ú–∞–≥–∞–∑–∏–Ω—ã</a>
      </div>

      <div class="content">
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        {% if request.query_params.get('success') == 'saved' %}
        <div class="alert alert-success">
          ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!
        </div>
        {% elif request.query_params.get('error') == 'employee_not_found' %}
        <div class="alert alert-danger">
          ‚ùå –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω!
        </div>
        {% elif request.query_params.get('error') == 'server_error' %}
        <div class="alert alert-danger">
          ‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞!
        </div>
        {% endif %}

        <h3>üìÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ–Ω</h3>
        {% if message %}<p>{{ message }}</p>{% endif %}
        
        <!-- –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="form-section">
          <h4>–°–æ–∑–¥–∞—Ç—å —Å–º–µ–Ω—É</h4>
          <form method="post" action="/admin/planning/save">
            <table class="table">
              <tr>
                <td><label for="employee_id">–°–æ—Ç—Ä—É–¥–Ω–∏–∫:</label></td>
                <td>
                  <select id="employee_id" name="employee_id" required style="width: 100%; padding: 8px;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</option>
                    {% for employee in employees %}
                    <option value="{{ employee.id }}">
                      {{ employee.full_name or employee.email }} 
                      ({{ "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä" if employee.role == "admin" else "–°–æ—Ç—Ä—É–¥–Ω–∏–∫" }})
                    </option>
                    {% endfor %}
                  </select>
                </td>
              </tr>
              <tr>
                <td><label for="work_date">–î–∞—Ç–∞:</label></td>
                <td><input type="date" id="work_date" name="work_date" required style="width: 100%; padding: 8px;"></td>
              </tr>
              <tr>
                <td><label for="shift_type">–¢–∏–ø —Å–º–µ–Ω—ã:</label></td>
                <td>
                  <select id="shift_type" name="shift_type" required style="width: 100%; padding: 8px;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–º–µ–Ω—ã</option>
                    <option value="morning">–£—Ç—Ä–æ (8:00-16:00)</option>
                    <option value="evening">–í–µ—á–µ—Ä (16:00-24:00)</option>
                    <option value="night">–ù–æ—á—å (0:00-8:00)</option>
                    <option value="day">–î–µ–Ω—å (9:00-18:00)</option>
                    <option value="weekend">–í—ã—Ö–æ–¥–Ω–æ–π</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td colspan="2">
                  <button type="submit" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–º–µ–Ω—É</button>
                </td>
              </tr>
            </table>
          </form>
        </div>
        
        <!-- –°–ø–∏—Å–æ–∫ —Ç–µ–∫—É—â–∏—Ö —Å–º–µ–Ω -->
        {% if current_schedules %}
        <div class="form-section">
          <h4>–¢–µ–∫—É—â–∏–µ —Å–º–µ–Ω—ã</h4>
          <table class="table">
            <thead>
              <tr>
                <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                <th>–î–∞—Ç–∞</th>
                <th>–°–º–µ–Ω–∞</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
              </tr>
            </thead>
            <tbody>
              {% for schedule in current_schedules %}
              <tr>
                <td>
                  {{ schedule.user.full_name or schedule.user.email }}
                  <br><small style="color: #666;">({{ "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä" if schedule.user.role == "admin" else "–°–æ—Ç—Ä—É–¥–Ω–∏–∫" }})</small>
                </td>
                <td>{{ schedule.work_date.strftime('%d.%m.%Y') }}</td>
                <td>
                  {% if schedule.shift_type == 'morning' %}
                    <span style="background: #17a2b8; color: white; padding: 4px 8px; border-radius: 3px; font-size: 0.8em;">–£—Ç—Ä–æ (8:00-16:00)</span>
                  {% elif schedule.shift_type == 'evening' %}
                    <span style="background: #ffc107; color: #212529; padding: 4px 8px; border-radius: 3px; font-size: 0.8em;">–í–µ—á–µ—Ä (16:00-24:00)</span>
                  {% elif schedule.shift_type == 'night' %}
                    <span style="background: #6c757d; color: white; padding: 4px 8px; border-radius: 3px; font-size: 0.8em;">–ù–æ—á—å (0:00-8:00)</span>
                  {% elif schedule.shift_type == 'day' %}
                    <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 3px; font-size: 0.8em;">–î–µ–Ω—å (9:00-18:00)</span>
                  {% elif schedule.shift_type == 'weekend' %}
                    <span style="background: #dc3545; color: white; padding: 4px 8px; border-radius: 3px; font-size: 0.8em;">–í—ã—Ö–æ–¥–Ω–æ–π</span>
                  {% else %}
                    <span style="background: #e9ecef; color: #495057; padding: 4px 8px; border-radius: 3px; font-size: 0.8em;">{{ schedule.shift_type }}</span>
                  {% endif %}
                </td>
                <td>
                  <span style="background: {{ '#28a745' if schedule.published else '#ffc107' }}; color: {{ 'white' if schedule.published else '#212529' }}; padding: 4px 8px; border-radius: 3px; font-size: 0.8em;">
                    {{ '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ' if schedule.published else '–ß–µ—Ä–Ω–æ–≤–∏–∫' }}
                  </span>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="form-section">
          <p>–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–º–µ–Ω.</p>
        </div>
        {% endif %}
      </div>
    </div>
  </body>
</html>

